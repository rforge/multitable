 \documentclass[12pt]{ecology}

\usepackage{tikz}
\usepackage{textpos}
\usepackage{verbatim}
\usepackage{rotating}

\input{mythesisdefs}
\renewcommand{\listfigurename}{Figure legends}  % changes the name of the list of figures
\linenumbers 

%\title{What do community-weighted traits tell us about trait-by-environment interactions on species abundances?}
%\title{A linear theory on the effects of interactions between site and species characteristics on community composition}
%\title{What are we missing with community-weighted traits?}
%\title{Understanding the variation lost by community-weighted traits}
%\title{What information is lost by community-weighted mean traits and other trait-based statistical procedures?  The importance of residual analysis}
\title{Information loss via community-weighted averaging and other trait-based analyses:  how signal + noise modeling can help}
%\title{Taxon effects and other phenomena left undetected by trait-based community ecology:  a mixed-effects approach}
%\title{A mixed modelling approach to combining both taxonomic and trait-based information }
\runninghead{T-by-E interactions}
\author{Steven C. Walker}
\coauthor{Guillaume Gu\'{e}nard, Pierre Legendre, Beatrix Beisner}
\runningauthor{Walker et al.}
\address{Universit\'{e} de Montr\'{e}al}
\email{steve.walker@utoronto.ca}

\begin{document}
\maketitle
% left justification with indented paragraphs
\raggedright
\parindent=1.5em

\abstract{

}

\section{Introduction}

Perhaps one of community ecology's few laws is that species respond differently to spatial, temporal, and environmental gradients \citep{Gleason1917,Whittaker1967}.  These differences are not entirely due to neutral historical contingencies, but are maintained by corresponding differences in the traits of species (e.g. \citenp{Tilman1982}; \citenp{Reynolds1984}; \citenp{Tilman1988}; \citenp{LegendreEtAl1997}; \citenp{Tilman2004}; \citenp{AckerlyAndCornwell2007}), which implies that gradients can be characterised and understood in terms of the traits of the species that vary along them.  The methodology of community-weighted mean traits is often used for such characterisations (e.g. \citenp{EhleringerAndCooper1988}; \citenp{DiazAndCabido1997}; \citenp{terSteegeEtAl2006}; \citenp{DiazEtAl2007}; \citenp{FortunelEtAl2009}; \citenp{LavorelEtAl2011}; \citenp{SpasojevicAndSuding2011}).  In this approach, traits are averaged over the species found in a series of replicate sites.  This averaging is done in a weighted manner where the weights are measures of the relative abundance or occurrence of the species at each site.  Community-weighted means can be used to address questions such as:  `are cooler sites associated with larger-bodied species on average?' or `are more urbanized sites associated with a higher proportion of invasive species?'.  By relating species characteristics to site characteristics in this way, ecologists are building the empirical foundation necessary for unifying community ecology with mechanistic approaches in physiological ecology and biogeochemistry (e.g. \citenp{McGillEtAl2006}).

Still, potentially important information is lost when community-weighted means are used, because averaging removes variation.  The most common way to manage this problem is to use functional and taxonomic diversity indices (e.g. \citenp{PetcheyAndGaston2002}; \citenp{WalkerEtAl2008}) to quantify variation around community-weighted means (e.g. \citenp{DiazEtAl2007}; \citenp{SpasojevicAndSuding2011})---more indices capture more information.  However, this approach raises challenging questions about which indices to use (e.g. \citenp{PodaniAndSchmera2006}; \citenp{PetcheyAndGaston2007}; \citenp{PoosEtAl2009}).  Another approach is to use randomisation tests to directly assess hypotheses about the relationships between species and site characteristics and site-by-species abundance (or occurrence) matrices (e.g. \citenp{DoledecEtAl1996}; \citenp{LegendreEtAl1997}; \citenp{AckerlyAndCornwell2007}; \citenp{DrayAndLegendre2008}; \citenp{CormontEtAl2011}).  However, because this approach specifies only the null and not the alternative model, it risks having low power for detecting the most interesting departures from the null---a form of information loss.

Here we argue that information loss in trait-based community studies can be assessed by fitting statistical models to sites-by-species abundance (or occurrence) matrices, using site and species characteristics as explanatory variables.  The key to this approach is that the models are fitted to the full data, not a summarised version of them.  The fitted abundances (or occurrences) of such full-data-models can also be used to make inferences about community-weighted means and other functional diversity summaries, but with the added benefit of providing diagnostic tools for assessing information lost by summarisation.  Models that are capable of providing such tools have only recently begun to be considered (e.g. \citenp{WebbEtAl2010}; \citenp{IvesAndHelmus2011}).  Here we (1) propose simple conceptual  graphical models that identify the types of information that can be lost via community-weighted averaging and (2) demonstrate how full-data-modelling can clarify what information is lost by trait-based summaries, using data on a zooplankton community in Lac Croche, Qu\'{e}bec, Canada.

%  This approach provides a decomposition of the data into signal and noise.  Therefore, one can check the residuals for systematic trends, the existence of which indicates missing information in the signal portion of the model---suggesting model improvements.  

\section{Illustrative graphical models}

Let $y_{ij}$ be the abundance or occurrence of species $j (= 1, ..., m)$ at site $i (= 1, ..., n)$ and $z_j$ be the value of a particular trait for species $j$.  The community-weighted mean of this trait is,
\begin{equation} 
\bar{z}_i = \sum_{j=1}^m \frac{y_{ij} z_j}{y_{ij}}
\label{eq:cwmdef}
\end{equation}
This equation allows us to summarise the $nm$ species abundances and $m$ trait values into $n$ community-weighted means.  Therefore, the original data are composed of $\frac{m(n + 1)}{n} \approx m$ ($\equiv$ species richness) times as many numbers as the summarised data, indicating the potential for information loss via summarisation.  The purpose of this paper is to explore the consequences of this information loss when studying communities along gradients.
%, and to propose an alternative to community-weighted means.

Our key theoretical result is that a single pattern of community-weighted means can arise from otherwise distinguishable metacommunities.  Consider the simulated positive relationship between a community-weighted mean trait and an environmental gradient in Figure \ref{fig:graphicalmodels}A.  This figure consists of seven different curves from different hypothetical metacommunities of eleven species each (Figures \ref{fig:graphicalmodels}B-H), but the curves are so similar that they are indistinguishable.  The first metacommunity (Figure \ref{fig:graphicalmodels}B) serves as a control because it is one of the simplest scenarios consistent with the increasing curve in Figure \ref{fig:graphicalmodels}A.  In this metacommunity, species with large trait values respond positively to the gradient whereas those with small values respond negatively---a trait-gradient interaction.  Still, many other scenarios are also consistent with Figure \ref{fig:graphicalmodels}A.

\begin{figure}

\includegraphics[width=5.5in]{multispeciesCWMcartoons.pdf}

\caption{The relationships between a community-weighted mean trait and an environmental gradient (A) for seven different metacommunities (B-H).  The lines in (A) are indistinguishable, indicating that information on the differences of the metacommunities is lost by community-weighted averaging.  The lines in B-H correspond to individual species, with trait value indicated by numbers.}
\label{fig:graphicalmodels}

\end{figure}

In the control metacommunity (Figure \ref{fig:graphicalmodels}B), species' trait values determine their response to the gradient; we refer to cases where this is not true as taxon effects, which indicate that measured traits are unable to explain differences in how taxa respond to measured gradients.  For example, the metacommunity in Figure \ref{fig:graphicalmodels}C contains groups of species with identical trait values, which nevertheless have different relationships with the gradient.  A more subtle taxon effect is depicted in Figure \ref{fig:graphicalmodels}D.  Here, each species has its own unique trait value, but some species behave very differently from other species with similar trait values.  For example, the species with value 0.4 is negatively related to the gradient whereas the species with value 0.2 is positively related.  Taxon effects are not detectable with community-weighted means.

In the control metacommunity (Figure \ref{fig:graphicalmodels}B), there is no overall relationship between abundance and the gradient (as one species declines another increases to compensate); we refer to cases where this is not true as main gradient effects.  For example, the metacommunity in Figures \ref{fig:graphicalmodels}E and F are characterised by positive and negative main gradient effects.  Notice further that although the community-weighted mean increases along the gradient, main gradient effects can result in species with negative trait values to actually increase (e.g. Figure \ref{fig:graphicalmodels}E).  Main gradient effects are not detectable with community-weighted means.

In the control metacommunity (Figure \ref{fig:graphicalmodels}B), beta diversity is relatively low (species with positive trait values are abundant at one side of the gradient while those with negative values are abundant at the other); we refer to cases where this is not true as effects on beta diversity.  For example, the metacommunity in Figure \ref{fig:graphicalmodels}G has much higher beta diversity because species have more restricted environmental tolerances.  Figure \ref{fig:graphicalmodels}H gives a more complex example, where species with more extreme trait values have higher abundances.  Effects on beta diversity are not detectable with community-weighted means.

\section{Methods}

\subsection{Data}

The information lost by community-weighted analyses is not just a theoretical issue, but can also have consequences for interpreting real data.  We now illustrate these consequences by analysing the dynamics of the zooplankton community in a basin of Lac Croche, Qu\'{e}bec, Canada.  The densities of twelve zooplankton taxa were sampled ten times throughout the summer of 2008 between ?? and ??.    Talk about definition of `taxa'????

For simplicity of exposition, we focus on the relationship between density, a single gradient, and a single trait.  However, our ideas are applicable to any measure of abundance and occurrence and arbitrarily many gradients and traits.  We use Julian day as our gradient, as lakes undergo many environmental changes throughout the summer season such as a deepening thermocline and increasing water temperature.  We use average body length (mm) as our trait, as body size is likely to influence how different zooplankton taxa respond to seasonal environmental changes.  ***NEEDS TO BE MUCH BETTER HERE***.  When referring to this data set specifically, we denote density, Julian day, and body length as \texttt{den}, \texttt{day}, and \texttt{size} respectively.  When referring to a general data set, we denote abundance (or occurrence), gradients, and traits as $y_{ij}$, $x_i$, and $z_j$.

%In particular, we show that the response of a community-weighted trait along an environmental gradient can be driven by a single group, indicating that inferred patterns may not have very much relevance at the community level.  We then demonstrate how more detailed modelling of the joint effects of a gradient and a functional trait on species' abundances provides a much clearer picture of community structure.

\subsection{Statistical models}

Our central argument is that models based on the full (un-summarised) data provide a richer tool for description, explanation, and prediction than models based on data summaries.  Models that are based on summarised data can only be used to explain patterns in these summaries, and not in the full data,
\begin{equation}
\begin{tikzpicture}
  \node (full) at (0,0) {full data};
  \node (sum) at (5,0) {summarised data};
  \node (mod) at (9,0) {model};
  \draw[->] (full) to node [above] {\scriptsize summarisation} (sum);
  \draw[->] (sum) to [out = 11, in = 160] node [above] {\scriptsize fitting} (mod);
  \draw[->] (mod) to [out = -160, in = -11] node [below] {\scriptsize explanation} (sum);
\end{tikzpicture}
\end{equation}
However, models based on the full data can potentially be used to explain patterns in either the full data themselves, or in any summary of them,
\begin{equation}
\begin{tikzpicture}
  \node (full) at (0,3.5) {full data};
  \node (mod) at (4,3.5) {model};
  \node (sum) at (2,0) {summarised data};
  \draw[->] (full) to [out = 10, in = 170] node [above] {\scriptsize fitting} (mod);
  \draw[->] (mod) to [out = -170, in = -10] node [below] {\scriptsize explanation} (full);
  \draw[->] (full) to node [below, rotate = -60] {\scriptsize summarisation} (sum);
  \draw[->] (mod) to node [below, rotate = 60] {\scriptsize explanation} (sum);
\end{tikzpicture}
\end{equation}

More specifically, summarised-data-models in the present context use trait-abundance summaries (e.g. community-weighted means; functional diversity indices) as response variables and gradients (e.g. temperature; time since disturbance) as explanatory variables.  The full-data-models use abundance (or occurrence) as a response variable and gradients and traits as explanatory variables.  The summary that we focus on in this article is the community-weighted mean.  Appendix ?? describes the mathematical details of how to use full-data-models to make inferences about community-weighted means.

%Although full-data models are not based on data summaries, they can be used to make inferences about summaries.

%In particular, note that community-weighted means, $\bar{z}_i$, depend on both abundances, $y_{ij}$, and traits, $z_j$ (Eq.??).  A fitted full-data-model results in fitted probability distributions for each of the $y_{ij}$.  These distributions induce subsequent probability distributions for each of the community-weighted means, because these summaries depend on the $y_{ij}$.  The averages of these distributions for the community-weighted means provide point estimates of the true community-weighted means.  Therefore, even though full-data-models do not model data summaries directly, they can be used to make inferences about such summaries.


%In trait-based community ecology, it is not sufficient to describe how different taxa respond to gradients.  Instead, we seek to understand what traits are responsible for this interspecific variation in gradient responses.  Therefore, our main causal question of interest is:  what are the effects of interactions between gradients and traits on abundance (or occurrence)?  We begin to explore this question by considering models of the form,

For simplicity of exposition, the full-data-models that we consider are linear with one site and one taxon characteristic only.  However, our methods are applicable to generalised linear models with arbitrary numbers of explanatory variables (Appendix).  We begin with fixed-effects models of the form,
\begin{equation}
\hat{y}_{ij} = c + 
	\sum_k b_k \mathrm{f}_k (x_i, z_j)
\end{equation}
where the $\hat{y}_{ij}$ are fitted values for the $y_{ij}$, the $\mathrm{f}_k$ are known functions of the site and taxon characteristics, the $b_k$ are coefficients, and the $y_{ij}$ are distributed normally with means $\hat{y}_{ij}$,
\begin{equation}
y_{ij} \sim \mathcal{N}(\hat{y}_{ij},\sigma^2)
\end{equation}
This model is a generalisation of the trait-based model considered by \citet{CormontEtAl2011} and is known in the statistics literature as a bilinear model \citep{Gabriel1998}.  The \citet{CormontEtAl2011} model is the special case for which $\mathrm{f}_1(x_i, z_j) = x_i$, $\mathrm{f}_2(x_i, z_j) = z_j$, and $\mathrm{f}_3(x_i, z_j) = x_i z_j$.  The third function accounts for standard multiplicative interactions between the site and taxon characteristics.  Note also however that this model can characterise main gradient effects (Fig. ??) by the first function, as well as main trait effects by the second; thus, we view the approach of \citet{CormontEtAl2011} as an advance over standard community-weighted mean trait and functional diversity analyses.  By extending the model to include two other functions, $\mathrm{f}_4(x_i, z_j) = x_i^2$ and $\mathrm{f}_5(x_i, z_j) = x_i^2 z_j$, non-linearities in gradient responses can be modelled and therefore effects on beta diversity (Fig. ??) assessed.

A major shortcoming of this bilinear model is that it does not account for taxon effects (Fig. ??), which will be present whenever there are unmeasured (or unconsidered) traits that explain substantial portions of variation in species' gradient responses (Section ??).  The simplest taxon effects are differences in residual variance among taxa.  We account for these effects by giving each taxon its own residual variance parameter,
\begin{equation}
y_{ij} \sim \mathcal{N}(\hat{y}_{ij},\sigma_j^2)
\end{equation}
A more challenging type of taxon effect can be detected as a taxon-specific bias and / or trend in the residuals.  Because these taxon effects result from unmeasured (or unconsidered) traits, they offer little insight for trait-based community ecology.  Furthermore, incorporating fixed taxon effects into the model requires many degrees of freedom (proportional to species richness, $m$).  Still, taxon effects should be accounted for in order to provide reliable estimates of the effects of measured traits.

Mixed effects models (refs?) often provide useful tools to account for nuisance sources of variability (taxon effects in this case), which are economical in degrees of freedom.  Here we modify Eq. ?? as a mixed model by adding random effects of the gradient, with taxon as the grouping factor,
\begin{equation}
\hat{y}_{ij} = c + 
	\sum_k b_k \mathrm{f}_k (x_i, z_j) + 
	\sum_l \beta_{lj} \mathrm{g}_l (x_i)
\end{equation}
where the $\mathrm{g}_l$ are known functions of the site characteristics and the $\beta_l$ are coefficients for random effects assumed to be normally distributed,
\begin{equation}
\beta_{lj} \sim \mathcal{N}(0,\sigma_l^2)
\end{equation}

This model is highly flexible and can account of a wide variety of taxon effects, main gradient effects, main trait effects, and effects on beta diversity.  The main challenge in applying our approach is to identify which of these types of effects are required to adequately model a particular data set (e.g. Lac Croche).  Rather than applying an automatic model selection algorithm (e.g. minimum AIC; step-wise F-tests), we recommend visually examining the residuals of tentative models in order to identify effects that either should or should not be included in the final model (e.g. \citenp{GelmanAndHill2007}; \citenp{ZuurEtAl2009}); ***why this approach???? (Appendix ??).  We used the \texttt{R} \texttt{lm} and \texttt{lme} functions for fitting fixed- and mixed-effects models \citep{R2009}.

%\subsection{Model identification, fitting, and checking}

%We use visual inspection of residuals to identify when one of these types of effects is missing from a model.     Missing effects can usually be detected via an examination of the residuals.    

%For inadequate models, we expect to find evidence of violated assumptions in the residuals.

\section{Results}

Community-weighted body length was negatively related to \texttt{day}, implying that communities became more dominated by smaller-bodied species throughout the season.  This negative relationship was detected by both a summarised-data-model (ordinary linear regression, solid line in Figure \ref{fig:cwmfits}, $F = 65.1$, $p < 0.001$) and full-data-model (linear mixed-effects model, curved dotted line in Figure \ref{fig:cwmfits}, conditional-LR $= 137.4$, $p < 0.001$).  Unlike the summarised-data-model, the full-data-model predicts a deceleration of the rate of decline in community-weighted body length.  This deceleration keeps the predicted values greater than the minimum possible community-weighted mean (i.e. the body length of the smallest species, given by the thick horizontal line in Figure \ref{fig:cwmfits}); in contrast, the linear model predicted unrealistically low community-weighted means late in the season.  

\begin{figure}
\includegraphics{cwmfits.pdf}
\caption{}
\label{fig:cwmfits}
\end{figure}

The form of this fitted full-data-model is,
\begin{equation}
\mathtt{den} \sim \mathtt{size} + \mathtt{size}^2 + (\mathtt{length} + \mathtt{length}^2 | \mathtt{taxon})
\end{equation}

More importantly, the full-data-model provides a more rich description of the data, as it is not only able to describe the community-weighted mean pattern but also the full non-summarised data (lines in Figure \ref{fig:randomeffectsfit}).  The data for each species in Figure ?? are plotted in separate panels, which are ordered by body length.  This ordering helps to assess the degree to which body length explains inter-specific variation in gradient responses.  

\begin{figure}
\includegraphics{randomeffectsfit.pdf}
\caption{}
\label{fig:randomeffectsfit}
\end{figure}


\section{discussion}

If we stopped at the picture of community-weighted mean body length against Julian day, we would have made a story about the relationship between the gradient and body length \emph{per se}.  But, by taking our more detailed approach, we see that there is very little evidence for such a story.  In fact, the data are more consistent with the idea that one small-bodied taxon, colonial rotifers, increases in abundance throughout the season, and this is the primary driver of the decline of community-weighted mean body length.  Furthermore, the variance component due to taxon effects is very large (??).  Finally, after taking account of the taxon effects, the model found no evidence of an interaction between body length and Julian day, but rather that taxa with more extreme body lengths tend to be more abundant.  Thus our approach provides a much clearer picture of what the data are saying (i.e. much less information loss).

Taxon effects may at first seem to be a problem in trait-based community ecology, but we see them as a valuable asset.  The presence of taxon effects provides a useful diagnostic for detecting whether unmeasured (or unconsidered) traits are important drivers of variation in species' responses to environmental, spatial, and temporal gradients.  Compare this situation with the usual case in observational statistics, in which there is no general diagnostic tool for detecting the influence of unmeasured variables---commonly leading to biased estimates of the effects of measured variables (e.g. ).  Not only have we demonstrated that taxon effects can provide an important diagnostic tool, but we have also illustrated how to use taxon effects in mixed-effects models to provide better estimates of the effects of measured traits of species' gradient responses.

Extensions of the modelling approach (e.g. censoring; link functions; etc.).

%Simply by looking at the residuals for six fixed-effects models, we have uncovered much information about the data.  

Polar bears!


\bibliographystyle{ecology}
% ***   Set the bibliography file.   ***
% ("thesis.bib" by default; change if needed)
\bibliography{/Users/stevenwalker/Documents/Bibliography/Bibliography}

\end{document}