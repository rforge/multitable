 \documentclass[12pt]{ecology}

\usepackage{tikz}
\usepackage{textpos}
\usepackage{verbatim}
\usepackage{rotating}

\input{mythesisdefs}
\renewcommand{\listfigurename}{Figure legends}  % changes the name of the list of figures
\linenumbers 

%\title{What do community-weighted traits tell us about trait-by-environment interactions on species abundances?}
%\title{A linear theory on the effects of interactions between site and species characteristics on community composition}
%\title{What are we missing with community-weighted traits?}
%\title{Understanding the variation lost by community-weighted traits}
%\title{What information is lost by community-weighted mean traits and other trait-based statistical procedures?  The importance of residual analysis}
%\title{Taxon effects and other phenomena left undetected by trait-based community ecology:  a mixed-effects approach}
%\title{A mixed modelling approach to combining both taxonomic and trait-based information }
%\title{Information loss via community-weighted averaging and other trait-based analyses:  how signal + noise modeling can help}
%\title{Alternatives to the `summarise first, ask questions later' approach to trait-based statistical community ecology}
%\title{What information is lost when trait data are summarised, before they are modelled? The case of community-weighted means}
%\title{Summarising trait data with community-weighted means leads to information loss}
\title{Modelling the variation around community-weighted means:  a mixed-model approach}
\runninghead{Community-weighted means}
\author{Steven C. Walker}
\coauthors{Guillaume Gu\'{e}nard\footnote{guillaume.guenard@gmail.com}, Beatrix E. Beisner\footnote{beisner.beatrix@uqam.ca}$^,$\footnote{D\'{e}partement de Sciences Biologiques, Universit\'{e} du Qu\'{e}bec \`{a} Montr\'{e}al}, Pierre Legendre\footnote{pierre.legendre@umontreal.ca}}
\runningauthor{Walker et al.}
\address{D\'{e}partement de Sciences Biologiques, Universit\'{e} de Montr\'{e}al, C.P. 6128, Succursale Centre-ville, Montr\'{e}al, Qu\'{e}bec H3C 3J7 Canada}
\email{steve.walker@utoronto.ca}

\begin{document}
\maketitle
% left justification with indented paragraphs
\raggedright
\parindent=1.5em

% Taxa vary in their responses to gradients because they also vary in their functional traits.
\abstract{Diversity varies along gradients because taxa respond to gradients according to their functional traits.  Community-weighted means are used to study the relationships between traits and gradients.  However, variation around these means contain potentially important information, which is lost when data are summarised in this way.  The most common approach to this issue is the analysis of functional diversity indices, which quantify the degree of variation around community-weighted means.  Here we describe an alternative and complementary approach, which uses a combination of graphical exploration and mixed-effects models to quantify the complex structure of such variation.}%     Here we describe a conceptual graphical model that illustrate the variety of ways that variation around community-weighted means can be structured.  We then describe how to detect such patterns of variation in real ecological data on zooplankton comunity dynamics.  Our approach is based on mixed-effects models ,  ---but that such lost information reappears in models of the full un-summarised data in the form of taxon effects, which represent variation caused by unconsidered taxon-level traits.  We describe an example from seasonal zooplankton community dynamics of such information loss: community-weighted body size was strongly related to a seasonal gradient, but mixed-effects models of the full un-summarised data revealed that body size actually explained very little variation in gradient responses.  Strong relationships between trait summaries and gradients do not provide convincing evidence that the traits being summarised are strongly related to the gradients.  Mixed-effects models of un-summarised data are more informative than analyses of summarised data.}

\keywords{community ecology, community-weighted means, functional diversity, functional traits, gradient analysis, information loss, mixed-effects models, taxon effects.}

\section{Introduction}

Perhaps one of the few valid laws in community ecology is that species respond differently to spatial, temporal, and environmental gradients \citep{Gleason1917,Whittaker1967}.  These differences are not entirely due to neutral historical contingencies, but are maintained by corresponding differences in the traits of species (e.g. \citenp{Tilman1982}; \citenp{Reynolds1984}; \citenp{AckerlyAndCornwell2007}), which implies that the ecological relevance of gradients can be characterised and understood in terms of the traits of the species that vary along them.  The methodology of calculating community-weighted mean traits is often used for such characterisations (e.g. \citenp{EhleringerAndCooper1988}; \citenp{terSteegeEtAl2006}; \citenp{DiazEtAl2007}; \citenp{SpasojevicAndSuding2011}).  In this approach, trait values are averaged over the species found in a series of sites.  This averaging is done in a weighted manner where the weights correspond to the relative abundance or other occurrence measure of the species at each site.  Community-weighted means are used to address questions such as:  `are cooler sites associated with larger-bodied species on average?' or `are more urbanized sites associated with a higher proportion of invasive species?'.  By relating species characteristics to site characteristics in this way, ecologists are building the empirical foundation necessary for unifying community ecology with mechanistic approaches in physiological ecology and biogeochemistry (e.g. \citenp{McGillEtAl2006}).

Still, variation around these community-weighted means is always present, and this variation can provide valuable information about community structure and dynamics.  The most common way to account for such variation is to use functional diversity indices \citetext{e.g. \citealp{PetcheyAndGaston2002, DiazEtAl2007, WalkerEtAl2008, SpasojevicAndSuding2011}}.  Such uses of diversity indices have generated valuable insights into the structure \citetext{e.g. \citenp{PetcheyAndGaston2002}}, function \citetext{e.g. \citenp{DiazEtAl2007}}, and assembly \citetext{e.g. \citenp{SpasojevicAndSuding2011}} of ecological communities.

Although functional diversity indices have been useful tools for accounting for variation around community-weighted means, researchers often find that a better understanding of the data requires analysing the influence of idiosyncratic species \citetext{e.g. \citenp{DiazEtAl2007}}.  A single species may respond to a gradient in a very different manner from the rest of the species, in a way that is not predictable from their measured traits, and such idiosyncrasies can often be important.  Relating to the example above, a dominant invasive species that happens to be more abundant in rural areas may mask the generally increasing proportion of invasive species along an urbanisation gradient in an analysis of community-weighted means; in such a case, both the general pattern and its idiosyncrasies provide useful information.

Here we describe an approach using mixed-effects models to account for the complex structure of variation around community-weighted means.  Our approach involves fitting statistical models to sites-by-species abundance (or occurrence) matrices, and using both site and species characteristics as explanatory variables.  The key to this approach is that the models are fitted to the full data, not a summarised version of them.  The fitted abundances (or occurrences) of such full-data-models can also be used to make inferences about community-weighted means and other functional diversity summaries, but with the added benefit of providing diagnostic tools for revealing the complex structure of variation around community-weighted means.  Models capable of providing such tools have only recently begun to be considered \citetext{e.g. \citealp{WebbEtAl2010, CormontEtAl2011, IvesAndHelmus2011, PollockEtAl2012, JamilEtAl2012}}.

Here we (1) use graphical models to illustrate the variety of ways that variation around community-weighted means can be structured and (2) show how full-data-modelling can help to reveal this structure, using data on a zooplankton community in Lac Croche, Qu\'{e}bec, Canada.

%---more indices capture more information in the data

%However, this approach raises challenging questions about which indices to use (e.g. \citenp{PodaniAndSchmera2006}; \citenp{PoosEtAl2009}).    However, although this approach is useful for detecting the presence of relationships, information on the functional form of these relationships is largely ignored \citep{IvesAndHelmus2011}.

%Another approach uses randomisation tests to directly assess hypotheses on the relationships between species and site characteristics and site-by-species abundance (or occurrence) matrices (e.g. \citenp{DoledecEtAl1996}; \citenp{LegendreEtAl1997}; \citenp{AckerlyAndCornwell2007}; \citenp{DrayAndLegendre2008}; \citenp{CormontEtAl2011}).



% PEDRO'S GOOD SUGGESTION (previously this statement was too negative):  Here we (1)...



%  This approach provides a decomposition of the data into signal and noise.  Therefore, one can check the residuals for systematic trends, the existence of which indicates missing information in the signal portion of the model---suggesting model improvements.  

\section{Illustrative graphical models}
\label{sec:graphmod}

Let $y_{ij}$ be the abundance or occurrence of species $j (= 1, ..., m)$ at site $i (= 1, ..., n)$ and $z_j$ be the value of a particular trait for species $j$.  The community-weighted mean of this trait is,
\begin{equation} 
\bar{z}_i = \frac{\sum_{j=1}^m y_{ij} z_j}{\sum_{j=1}^m y_{ij}}
\label{eq:cwmdef}
\end{equation}
This equation summarises the $nm$ species abundances and $m$ trait values into $n$ community-weighted means.  The full data are composed of $\frac{m(n + 1)}{n} \approx m$ ($\equiv$ total species richness) times as many numbers as the summarised data, providing the degrees of freedom required for variation around community-weighted means.

%The purpose of this paper is to explore the consequences of this information loss when studying communities along gradients, and to propose an alternative to community-weighted means.

Our key conceptual result is that a single pattern of community-weighted means can arise from otherwise distinguishable communities.  Consider the simulated positive relationship between a community-weighted mean trait and an environmental gradient in Figure \ref{fig:graphicalmodels}A.  This figure consists of seven different curves from different hypothetical communities of eleven species each (Figures \ref{fig:graphicalmodels}B-I), but the community-weighted mean curves are so similar that they are indistinguishable.  The first community (Figure \ref{fig:graphicalmodels}B) serves as a control because it is one of the simplest scenarios consistent with the increasing curve in Figure \ref{fig:graphicalmodels}A.  In this community, species with large trait values respond positively to the gradient whereas those with small values respond negatively---a trait-gradient interaction.  Still, many other scenarios are also consistent with Figure \ref{fig:graphicalmodels}A.

\begin{figure}
\caption[The relationships between a community-weighted mean trait and an environmental gradient (A) for seven different metacommunities (B-H).  The lines in (A) are indistinguishable, indicating that information on the differences of the metacommunities is lost by community-weighted averaging.  The lines in B-H correspond to individual species, with trait values indicated by numbers.]{}
\includegraphics[width=7in]{multispeciesCWMcartoonsMODIFIED.pdf}
\label{fig:graphicalmodels}

\end{figure}

In the control community (Figure \ref{fig:graphicalmodels}B), species trait values determine their response to the gradient; we refer to cases where this is not true as \emph{taxon effects}, which indicate that measured traits are unable to explain differences in how taxa respond to measured gradients.  For example, the community in Figure \ref{fig:graphicalmodels}C contains groups of species with identical trait values (five species with value +0.7, five with -0.7), which nevertheless have different relationships with the gradient.  A more subtle taxon effect is depicted in Figure \ref{fig:graphicalmodels}D.  Here, each species has its own unique trait value, but some species behave very differently from other species with similar trait values.  For example, the species with value 0.4 is negatively related to the gradient whereas the species with value 0.2 is positively related.  In the control community (Figure \ref{fig:graphicalmodels}B), there is no overall relationship between total abundance and the gradient (as one species declines, another increases to compensate); we refer to cases where this is not true as \emph{main gradient effects}.  For example, the communities in Figures \ref{fig:graphicalmodels}E and F are characterised by positive and negative main gradient effects.  In the control community (Figure \ref{fig:graphicalmodels}B), beta diversity is relatively low (species with positive trait values are abundant at one end of the gradient while those with negative values are abundant at the other); we refer to cases where this is not true as \emph{effects on beta diversity}.  For example, the communities in Figures \ref{fig:graphicalmodels}G-H have much higher beta diversity because species have more restricted environmental tolerances.  Almost all of the species in Figures \ref{fig:graphicalmodels}B-H have some relationship with the gradient; in contrast, Figure \ref{fig:graphicalmodels}I illustrates an extreme taxon effect in which only two species are at all related to the gradient; these two idiosyncratic species completely drive the community-weighted mean pattern (Figure \ref{fig:graphicalmodels}A), suggesting that---despite this pattern---the trait is not an important predictor of community structure.  Taxon effects, main gradient effects, effects on beta diversity, and idiosyncratic species are all not detectable with community-weighted means.

Similarly, a wide variety of different patterns may lead to cases where community-weighted means fail to detect any community change along gradients at all.  For example, if the dependence of $y_{ij}$ on $x_i$ and $z_j$ can be decomposed into two factors---one that depends on $x_i$ only and another that depends on $z_j$ only---then no relationship will exist between $\bar{z}_i$ and $x_i$.  Mathematically, we have assumed that,
\begin{equation}
y_{ij} = f(x_i) g(z_j)
\end{equation}
where $f$ and $g$ are known functions that lead to $y_{ij} > 0$ for all site-taxon combinations.  This assumption implies that,
\begin{equation}
\bar{z}_i = 
\frac{\sum_{j=1}^m f(x_i) g(z_j) z_j}{\sum_{j=1}^m f(x_i) g(z_j)} =  
\frac{f(x_i) \sum_{j=1}^m g(z_j) z_j}{f(x_i) \sum_{j=1}^m g(z_j)} = 
\frac{\sum_{j=1}^m g(z_j) z_j}{\sum_{j=1}^m g(z_j)}
\end{equation}
which says that $\bar{z}_i$ does not depend on $x_i$.  However, because there is enormous flexibility in the choice of $f$ and $g$, a wide variety of different patterns of community change along gradients can lead to cases where community-weighted means fail to detect any pattern at all.  In these cases, all of the information about community structure is contained in the variation around community-weighted means.

%Rearranging Eq. ?? gives,
%\begin{equation}
%\sum_{j=1}^m y_{ij} (z_j - \bar{z}_i) = 0
%\end{equation}

%\begin{equation}
%\frac{\sum_{j=1}^m y_{ij} z_j}{\sum_{j=1}^m y_{ij}} = 
%\frac{\sum_{j=1}^m y_{kj} z_j}{\sum_{j=1}^m y_{kj}}
%\end{equation}

The standard approach for accounting for such variation around community-weighted means is to consider functional diversity indices \citetext{e.g. \citealp{DiazEtAl2007, SpasojevicAndSuding2011}}.  We consider this approach by exploring the simulated communities in Figure \ref{fig:graphicalmodels} using a simple functional diversity index, called the community-weighted variance \citep{SonnierEtAl2010},
\begin{equation} 
\frac{\sum_{j=1}^m y_{ij} (z_j - \bar{z}_i)^2}{\sum_{j=1}^m y_{ij}} % \sigma_{z,i}^2 = 
\label{eq:cwvdef}
\end{equation}
Communities with higher community-weighted variance are more diverse, because the most abundant species in such communities vary more widely in their trait values, $z_j$.

Community-weighted variance (Figure \ref{fig:cwvar}) can indeed be used to quantify some of the variation around the community-weighted means in Figure \ref{fig:graphicalmodels}.  For example, community G (with a simple effect on beta diversity) has much smaller community-weighted variance than the other communities.  In contrast, all of the community-weighted variance curves share a qualitatively similar humped-shape.  Furthermore, communities B (control), E (positive main gradient effect), and F (positive main gradient effect) all share an identical curve.  Communities D and I have remarkably similar community-weighted mean (Figure \ref{fig:graphicalmodels}A) and variance (Figure \ref{fig:cwvar}) curves, but differ greatly in their underlying patterns (Figures \ref{fig:graphicalmodels}D, I).  Although these simple simulated examples lack the noise and complexity of real ecological data, they demonstrate that community-weighted variances may or may not distinguish between different structures of variation around community-weighted means.
\begin{figure}
\caption[Changes in community-weighted variance along the gradient in Figure \ref{fig:graphicalmodels}.  Each line corresponds to the lettered communities in that figure.]{}
\includegraphics[width=4in]{communityweightedvariance.pdf}
\label{fig:cwvar}
\end{figure}

Although the utility of functional diversity indices is well-established \citetext{e.g. \citealp{DiazEtAl2007, WalkerEtAl2008, SpasojevicAndSuding2011}}, we advocate a complementary and more direct approach to characterising the structure of variation around community-weighted means.  The structure of our simulated communities is fully described by graphing the relationship between each species' abundance (y-axis) and the gradient (x-axis), as well as the trait (line colour) (Figure \ref{fig:graphicalmodels}).  For example, the clear difference in how traits influence species' gradient responses between communities B (control) and G (effect on beta diversity) is plainly clear from a comparison of such graphs.  Even though community-weighted variances can distinguish these two patterns, the meaning of this difference is---for us---much clearer by looking at the relationships in the full un-summarised data.

Still, unlike our simple simulations, real ecological data are noisy.  Such noise increases the difficulty involved in discovering the structure of variation around community-weighted means.  Nevertheless, simple graphical exploration goes a long way towards describing such structure.  We argue that mixed-effects models are useful tools for highlighting and testing apparent patterns in these graphs, and illustrate this approach by modelling the seasonal dynamics of the zooplankton community in a basin of Lac Croche, Qu\'{e}bec, Canada.

%The information lost by community-weighted analyses is not just a theoretical issue, but can also have consequences for interpreting real data.  We now illustrate these consequences by modelling the dynamics of the zooplankton community in a basin of Lac Croche, Qu\'{e}bec, Canada.

\section{Methods}

\subsection{Data}

The data were collected as part of a study that experimentally manipulated the thermocline depth of two basins in Lac Croche \citep{CantinEtAl2011}; we use data from an un-manipulated control basin here.  The densities of twelve zooplankton taxa were sampled fortnightly between June 26 and October 29, 2008.  We use an inclusive definition of taxon, meaning any classification of individual organisms.  For simplicity of exposition, we focus on the relationships between density, a single gradient, and a single trait.  However, our ideas are applicable to any measure of abundance and occurrence and an arbitrary number of gradients and traits.  We use day-of-year as our gradient, as lakes undergo many environmental changes throughout the summer season such as a deepening thermocline and increasing water temperature.  We use average body length (mm) as our trait, as body size is likely to influence how different zooplankton taxa respond to seasonal environmental changes.   %Field methods are described by \citet{CantinEtAl2011}.

When referring to this data set specifically, we denote density, day-of-year, body length, and community-weighted body length as \texttt{den}, \texttt{day}, \texttt{size}, and \texttt{cwm} respectively; \texttt{den} is square-root transformed and \texttt{day} and \texttt{size} are z-scored in model fits but not plots.  When referring to a general data set, we denote abundance (or occurrence), gradients, traits, and community-weighted traits as $y_{ij}$, $x_i$, $z_j$, and $\bar{z}_i$.  We focus on comparing the relative merits of models based on un-summarised data, $(y_{ij}, x_i, z_j)$ (e.g. Figures \ref{fig:graphicalmodels}B-H), and data that have been summarised by taking community-weighted means, $(\bar{z}_i, x_i)$ (e.g. Figure \ref{fig:graphicalmodels}A).  Although we focus on community-weighted means, our general arguments hold for most summary metrics in trait-based community ecology.

\subsection{Statistical models}

We argue that models based on un-summarised data, $(y_{ij}, x_i, z_j)$, provide richer tools for description, explanation, and prediction than models based on data summaries, $(\bar{z}_i, x_i)$.  Models based on  summarised data can be used to explain patterns in these summaries, but not in the full data,
\begin{equation}
\begin{tikzpicture}
  \node (full) at (0,0) {full data};
  \node (sum) at (5,0) {summarised data};
  \node (mod) at (9,0) {model};
  \draw[->] (full) to node [above]
    {\scriptsize summarisation} (sum);
  \draw[->] (sum) to [out = 11, in = 160] node [above]
    {\scriptsize fitting} (mod);
  \draw[->] (mod) to [out = -160, in = -11] node [below]
    {\scriptsize explanation} (sum);
\end{tikzpicture}
\end{equation}
However, models based on the full data can potentially be used to explain patterns in either the full data themselves, or in any summary of them,
\begin{equation}
\begin{tikzpicture}
  \node (full) at (0,0) {full data};
  \node (mod) at (3.5,0) {model};
  \node (sum) at (8,0) {summarised data};
  \draw[->] (full) to [out = 10, in = 170] node [above] 
    {\scriptsize fitting} (mod);
  \draw[->] (mod) to [out = -170, in = -10] node [below]
    {\scriptsize explanation} (full);
  \draw[->] (full) to [out = 30, in = 173] node [above]
    {\scriptsize summarisation} (sum);
  \draw[->] (mod) to node [below]
    {\scriptsize explanation} (sum);
\end{tikzpicture}
\end{equation}
We do not prescribe the specific form that such models should take in any particular trait-based study, as this decision depends on a variety of factors, including data attributes and research goals.  However, we describe a variety of linear model forms that illustrate the important differences between summarised- and full-data-modelling.

We consider summarised-data-models of the form,
\begin{equation}
\hat{\bar{z}}_i = c + \sum_k b_k \mathrm{f}_k (x_i)
\end{equation}
where the $\hat{\bar{z}}_i$ are fitted values for the community-weighted means, $\bar{z}_i$ (Eq. \ref{eq:cwmdef}), the $\mathrm{f}_k$ are assumed functions (i.e. transformations) of the gradient, and $c$ and the $b_k$ are coefficients.  For simplicity we assume homogeneous and normal errors.  Note that the abundances, $y_{ij}$, and traits, $z_j$, only enter this model through the community-weighted means, $\bar{z}_i$, which summarise them.

To the contrary, full-data-models are fitted directly to the un-summarised data ($y_{ij}$, $x_i$, $z_j$).  Consider first a fixed-effects model,
\begin{equation}
\hat{y}_{ij} = c + 
	\sum_k b_k \mathrm{f}_k (x_i, z_j)
\label{eq:fixed}
\end{equation}
where the $\hat{y}_{ij}$ are fitted values for the $y_{ij}$, the $\mathrm{f}_k$ are assumed functions of the gradient and trait, $c$ and the $b_k$ are coefficients, and the $y_{ij}$ are distributed normally with means $\hat{y}_{ij}$ and variance $\sigma^2$.
%\begin{equation}
%y_{ij} \sim \mathcal{N}(\hat{y}_{ij},\sigma^2)
%\end{equation}

This full-data-model is a generalisation of the trait-based model considered by \citet{CormontEtAl2011} and is known in the statistics literature as a bilinear model \citep{Gabriel1998}.  The \citet{CormontEtAl2011} model (called linear trait-environment analysis, LTE) is the special case for which $\mathrm{f}_1(x_i, z_j) = x_i$, $\mathrm{f}_2(x_i, z_j) = z_j$, and $\mathrm{f}_3(x_i, z_j) = x_i z_j$.  The third function accounts for standard multiplicative interactions between the site and taxon characteristics.  Note also however that this model can characterise main gradient effects (Figure \ref{fig:graphicalmodels}E,F) by the first function, as well as main trait effects by the second; thus, we view the approach of \citet{CormontEtAl2011} as an advance over standard community-weighted mean trait and functional diversity analyses.  By extending the model to include two other functions, $\mathrm{f}_4(x_i, z_j) = x_i^2$ and $\mathrm{f}_5(x_i, z_j) = x_i^2 z_j$, effects on beta diversity (Figure \ref{fig:graphicalmodels}G,H) can be modelled.

%non-linearities in gradient responses can be modelled and therefore effects on beta diversity (Figure \ref{fig:graphicalmodels}G,H) assessed.

A major shortcoming of this bilinear model is that it does not account for taxon effects (Figure \ref{fig:graphicalmodels}C,D), which will be present whenever there are unmeasured (or unconsidered) traits that explain substantial portions of variation in species gradient responses (Section \ref{sec:graphmod}).  The simplest taxon effects are differences in residual variance among taxa.  We account for these effects by giving each taxon its own residual variance parameter, $\sigma_j^2$
%\begin{equation}
%y_{ij} \sim \mathcal{N}(\hat{y}_{ij},\sigma_j^2)
%\end{equation}

A more challenging type of taxon effect can be detected as a taxon-specific bias and / or trend in the residuals.  Because these taxon effects result from unmeasured (or unconsidered) traits, they offer little insight for trait-based community ecology.  Furthermore, incorporating fixed taxon effects into the model requires many degrees of freedom (proportional to total species richness, $m$).  Still, taxon effects should be accounted for in order to provide reliable estimates of the effects of measured traits.

Mixed effects models (e.g. \citenp{PinheiroAndBates2000}) provide useful tools to account for nuisance sources of variability (taxon effects in this case), which are economical in degrees of freedom.  Here we modify Eq. \ref{eq:fixed} as a mixed model by adding random effects with taxon as the grouping factor,
\begin{equation}
\hat{y}_{ij} = c + 
	\sum_k b_k \mathrm{f}_k (x_i, z_j) + 
	\sum_l \beta_{lj} \mathrm{g}_l (x_i)
\end{equation}
where the $\mathrm{g}_l$ are known functions of the site characteristics and the $\beta_{lj}$ are coefficients for random effects assumed to be normally distributed among taxa.  \citet{PollockEtAl2012} have successfully used this mixed-model form for developing joint species distribution models for entire communities.  \citet{JamilEtAl2012} studied the ability of a similar model for detecting trait-environment interactions.
%\begin{equation}
%\beta_{lj} \sim \mathcal{N}(0,\sigma_l^2)
%\end{equation}

This model is flexible and can account for a variety of taxon effects, main gradient effects, main trait effects, and effects on beta diversity.  The main challenge in applying our full-data approach is to identify which of these types of effects are required to adequately model a particular data set \citep{JamilEtAl2012}.  Rather than applying an automatic model selection algorithm (e.g. minimum AIC; step-wise F or likelihood ratio tests), we visually examine the residuals of tentative models in order to identify effects that either should or should not be included (e.g. \citenp{GelmanAndHill2007}) (Supplementary material).

We selected three models to analyse the data, using the \citet{WilkinsonAndRogers1973} `tilde' notation used in R to describe them.  In the summarised- data-model, \texttt{day} is used to linearly explain \texttt{cwm},
\begin{equation}
\mathtt{cwm} \sim \mathtt{day}
\label{eq:sdm}
\end{equation}
The first full-data-model uses both fixed- and random-effects to explain \texttt{den},
\begin{equation}
\mathtt{den} \sim \mathtt{size} + \mathtt{size}^2 + (\mathtt{day} + \mathtt{day}^2 | \mathtt{taxon})
\label{eq:fdmnointeraction}
\end{equation}
The fixed effects are linear and quadratic effects of body \texttt{size}; the random effects are linear and quadratic effects of \texttt{day}, with \texttt{taxon} as a grouping factor.  The \texttt{taxon} grouping factor accounts for taxon effects, while the $\mathtt{day^2}$ term accounts for effects on beta diversity.  Although there are no fixed main \texttt{day} effects, there are main \texttt{size} effects.  We also consider a second full-data-model with an extra fixed interaction of \texttt{size} and \texttt{day},
\begin{equation}
\mathtt{den} \sim \mathtt{size} + \mathtt{size}^2 + \mathtt{size:day} + (\mathtt{day} + \mathtt{day}^2 | \mathtt{taxon})
\label{eq:fdminteraction}
\end{equation}
We fitted the random-effects models with the \texttt{lme} function in the \texttt{R nlme} package; for fixed-effects models we used \texttt{lm} in the \texttt{stats} package (\citenp{R2012}; \citenp{PinheiroAndBates2000}).

We make inferences from these models using F-tests, likelihood ratio tests, and confidence intervals.  The likelihood ratio tests are used to test the significance of the \texttt{day} terms in models in Eqs. \ref{eq:fdmnointeraction} and \ref{eq:fdminteraction}.  The null model for these tests is given by,
\begin{equation}
\mathtt{den} \sim \mathtt{size} + \mathtt{size}^2 + (\mathtt{intercept} | \mathtt{taxon})
\label{eq:fdmnull}
\end{equation}
The supplementary material describes the inferences that we make in more detail.

\section{Results}

Community-weighted body length, \texttt{cwm}, was negatively and strongly related to Julian \texttt{day}.  This negative relationship was detected using the summarised-data-model (ordinary linear regression, solid line in Figure \ref{fig:cwmfits}, $F = 18.9$, $p = 0.002$) as well as the full-data-models (curved broken lines in Figure \ref{fig:cwmfits}, LRs $= 40.0, 38.0$, $p < 0.0001$ for both models), demonstrating increased dominance by smaller-bodied zooplankton later in the season.  This result suggests that body size has an effect on zooplankton community structure.  However, this effect is on the community-weighted mean; we now explore the variation around this mean, by further probing our full-data-models.   %   this result does not provide strong evidence that body \texttt{size} and \texttt{day} have a causal link, as is revealed next by further analysis of the more informative full-data-models.

\begin{figure}
\caption[The relationship between community-weighted mean body length and day-of-year, with the fitted values of three models (Eqs. \ref{eq:sdm}, \ref{eq:fdmnointeraction}, \ref{eq:fdminteraction}).]{}%  Thick horizontal line denotes the minimum possible community-weighted mean body length (i.e. the length of the smallest species).}
\includegraphics{cwmfits.pdf}
\label{fig:cwmfits}
\end{figure}

% interaction
The simplest full-data pattern consistent with a seasonally declining \texttt{cwm}, is that smaller (larger) taxa respond positively (negatively) to the \texttt{day} gradient (i.e. a negative interaction between \texttt{size} and \texttt{day}).  The estimate of this interaction is $-0.0051 \pm 0.0070$ ($\pm$ 95\%C.I.), suggesting that smaller taxa do indeed tend to be more positively related with \texttt{day} than larger taxa; but this effect is small (compare dotted red lines in Figure \ref{fig:randomeffectsfit}) and the confidence interval overlaps zero, indicating a lack of significance.  Therefore, this community-weighted mean pattern is not well understood as a simple trait-gradient interaction (as in Figure \ref{fig:graphicalmodels}B).

% idiosyncratic taxon effects
The observed decline in \texttt{cwm} is better understood as the result of idiosyncratic taxon effects.  Most taxa had only weak linear responses to the gradient (Figure \ref{fig:randomeffectsfit}), which is consistent with the idea of idiosyncratic taxa (Figure \ref{fig:graphicalmodels}I).  Inspection of this figure suggests that increasing abundance of one single small taxon (armoured rotifers) throughout the season explains most of the decline in \texttt{cwm}.  Furthermore, the three smallest taxa respond in completely different ways to \texttt{day} (top three panels in Figure \ref{fig:randomeffectsfit}).  This variety of responses implies that traits other than \texttt{size} are important sources of variation in \texttt{den}.  We use random taxon effects to estimate the importance of these unidentified sources, which appear quite important (compare solid versus dashed lines in Figure \ref{fig:randomeffectsfit}).
   
% main trait effects and no main gradient effect, but the gradient is still an important structuring factor
Despite limited evidence for a substantial interaction between \texttt{size} and \texttt{day}, both \texttt{size} and \texttt{day} have strong effects.  The quadratic \texttt{size} term was significantly positive ($0.053 \pm 0.020$; $\pm$ 95\% C.I.), meaning that intermediate sized taxa are less abundant than smaller and larger taxa (dotted lines in Figure \ref{fig:randomeffectsfit}).  The linear and quadratic taxon-specific relationships between \texttt{day} and \texttt{den} show that \texttt{day} is also an important structuring factor (Figure \ref{fig:randomeffectsfit}).

Taken together, these results suggest that although 

% although the negative $t$-value suggests that smaller taxa may tend to be more positively related with \texttt{day} than larger taxa (dotted red lines in Figure \ref{fig:randomeffectsfit}).  Thus, a strong relationship between \texttt{cwm} body size and \texttt{day} did not imply 



%However, these full-data-models  can provide more insight into  useful information in the full data may have been absent in these summaries.

%the use of summarised data may be have obscure the true relationships between \texttt{day}, \texttt{size}, and \texttt{den}.

%Unlike the summarised-data-model, the full-data-models predict a deceleration in the rate of decline in \texttt{cwm}.  This deceleration keeps the predicted values greater than the minimum possible \texttt{cwm} (i.e. the body length of the smallest species---thick horizontal line in Figure \ref{fig:cwmfits}); in contrast, the summarised-data-model predicted \texttt{cwm} values below the minimum, late in the season.  

%   The full-data-models suggest  tight link between \texttt{size} and \texttt{day} that is suggested by the summarised-data-models, as the interaction between \texttt{size} and \texttt{day} is not significant ($t = -1.6$, $p = 0.12$); although the negative $t$-value suggests that smaller taxa may tend to be more positively related with \texttt{day} than larger taxa (dotted red lines in Figure \ref{fig:randomeffectsfit}).  The \texttt{size} trait had a strong quadratic effect on \texttt{den}; in particular, intermediate sized taxa tend to be less dense than smaller and larger taxa (dotted lines in Figure \ref{fig:randomeffectsfit}, $0.072 \pm 0.019$, estimate $\pm$ 95\%C.I.).    Taxon effects explain a large proportion of the variation in the full data (compare solid versus dashed lines in Figure \ref{fig:randomeffectsfit}).  For example, the three smallest taxa (each with \texttt{size} = 0.18mm) respond in completely different ways to \texttt{day}; this is clear evidence of a taxon effect, because traits other than those modelled, must be responsible for this variation.

%The full-data-models fitted the full data well (lines in Figure \ref{fig:randomeffectsfit}).  The data for each species in Figure ?? are plotted in separate panels, which are ordered by body length.  This ordering helps to assess the degree to which body length explains inter-specific variation in gradient responses.  

\begin{figure}
\caption[Density (square-root-y-axis) as a function of day-of-year (x-axis) for taxa (different panels) that vary in body length (point sizes).  Taxa are ordered by body length (given in mm in parentheses).  Lines are fitted values from two full-data-models (Eqs. \ref{eq:fdmnointeraction}, \ref{eq:fdminteraction}).  Line colour indicates the model and line type indicates whether or not taxon effects are used to compute the fitted values.  Taxon codes are:  nauplii = copepod nauplii; armoured rot = armoured rotifers (\emph{Keratella, Kellicottia, Filinia, Lecane, Trichocerca} spp.); unprotected rot = unprotected rotifers (\emph{Asplanchna, Polarthra, Gastropus} spp.), Bosmina = \emph{Bosmina longirostris}; colonial rot = colonial rotifers (\emph{Conochilus} sp.); Cycl adults = adult cyclopoid copepods; Cal cope = juvenile calanoid copepods; Holopedium = \emph{Holopedium glacialis}; Daphnia l\&d = \emph{Daphnia longiremis} and \emph{dentifera}; Daphnia cat = \emph{Daphnia catawba}; Cycl cope = juvenile cyclopoid copepods; Cal adults = adult calanoid copepods.]{}
\includegraphics{randomeffectsfit.pdf}
\label{fig:randomeffectsfit}
\end{figure}

\section{Discussion}

It is tempting to interpret community-weighted mean traits as though they were the taxon-level traits themselves, as opposed to measures of central tendency in those traits among taxa.  Our conceptual and empirical examples expose serious problems with such interpretations.  In particular, the existence of a strong relationship between a gradient and a community-weighted mean trait does not provide evidence of a strong interaction between the gradient and the trait itself (compare Figures \ref{fig:cwmfits} and \ref{fig:randomeffectsfit}).  In fact, most of this community-weighted mean pattern is driven by one idiosyncratic taxon, and hence captures very little of the variation across the entire community.  Furthermore, any particular relationship between a gradient and a community-weighted trait (or functional diversity index) is consistent with a variety of community structures (Figure \ref{fig:graphicalmodels}), and therefore ignores potentially interesting variation.  Although multiple functional diversity indices are useful for quantifying this variation, we find that modelling the full data is a powerful and more direct alternative approach.

Our work has implications for current research in statistical ecology on how to detect and characterise trait-environment (or more generally, trait-gradient) relationships.  Simple but effective approaches use standard techniques to regress community-weighted means (and functional diversity indices) on gradients \citetext{e.g. \citealp{DiazEtAl2007, SpasojevicAndSuding2011}}.  However, these simple approaches can be challenged.  In particular, \citet{terBraakEtAl2012} use statistical theory to show that many statistics calculated jointly from abundance, environment, and trait data \citetext{i.e. three-table data; \citealp{DoledecEtAl1996, LegendreEtAl1997}} can appear significant even if abundances are independent of either the environment or the traits.  Using the corrected permutation procedure of \citet{terBraakEtAl2012} to test the slope of our \texttt{cwm}-\texttt{day} regression, we found a p-value of 0.60 in contrast with the significant p-value of 0.002 obtained from a standard F-test.  This illustrates that it is possible to have a \emph{(community-weighted) mean trait--environment} relationship, without the corresponding \emph{trait--environment} relationship.   **STILL NOT QUITE SURE HOW TO WORD THIS PARAGRAPH, BUT I THINK ITS IMPORTANT GIVEN THAT IT IS RELEVANT TO CUTING EDGE WORK IN STATISTICAL ECOLOGY**
%The reason for this fact has been interpreted as the lack of a link between abundance and either traits or environment \citetext{e.g. \citealp{DrayAndLegendre2008, CormontEtAl2011, terBraakEtAl2012}}.  The mixed-model perspective that we explore here provides a complementary framework for thinking about this issue.  

%   This fact has important implications for three-table analysis.    Our perspective suggests that the source of such discrepancies can be understood as variation around the community-weighted mean; once this extra variation is considered, 

%have interpreted such discrepancies as indicating the lack of a significant trait-environment relationship.  From one perspective, this interpretation is consistent with our finding that the \texttt{cwm}-\texttt{day} correlation does not reflect a trait-environment interaction.  However,  to interpret our result as suggesting     Our conclusion that correlations between community-weighted means and gradients do not imply trait-gradient interactions, has implications for the more general question of how to detect and characterise trait-gradient relationships more generally.  

Our results suggest that inference in trait-based community studies could be improved by incorporating taxonomic information.  Estimating the effects of traits and gradients on community structure from observational data is marred by the possibility of unobserved confounding factors.  In practice, these issues can be partially addressed by including surrogates of confounding factors into statistical models.  We showed that random taxon effects provide surrogates for unmeasured taxon-level traits with non-neglible effects.  Using this approach, we showed that the \texttt{day}-\texttt{cwm} correlation (Figure \ref{fig:cwmfits}) is more likely to be the result of idiosyncratic taxon effects than a \texttt{day}-\texttt{size} interaction.

Still, one may use our mixed-effects framework to probe more deeply into ecological complexity by considering more traits and gradients.  For example, zooplankton taxa can be divided into those with and without protective morphological adaptations (e.g. sharp spines), which are expected to mitigate invertebrate predation.  The gape-limitation of these predators implies that this effect should be stronger in smaller bodied zooplankton.  Indeed, among protected taxa, those with smaller bodies increased more rapidly through the season (Supplementary material).  As with all statistical modelling however, sample size imposes a limit on the degree to which such complexities can be probed.


% via an interaction between \texttt{day} and \texttt{size}.   

%This conclusion does not rule out the possibility that \texttt{day} and \texttt{size} are both implicated in a more complex causal, but rather 



%Considering taxon effects may at first seem antithetical to trait-based ecology, where the goal is to replace taxon effects with trait effects.  Given this goal, we agree that the number of estimated trait effects should be maximised in any given analysis.  However, 

%If all of the relevant traits are measured, it is possible that taxon effects will be unnecessary.  In practice however, it is rarely possible to find ensembles of traits that fully explain among-taxon variation in gradient responses.  Our approach of using taxonomic information as a surrogate for important unmeasured traits will often be useful for providing better estimates of the effects of focal traits of interest.

%We also illustrated the consequences of ignoring taxonomic information in trait-based studies, by describing taxon effects  (Figure \ref{fig:randomeffectsfit}).  Taxon effects may at first seem to be a problem in trait-based community ecology, but we see them as a valuable asset for causal inference; they provide useful diagnostics for detecting whether unmeasured (or unidentified) traits are important sources of variation.

%Although information is lost through community-weighted averaging and functional diversity indexing, these approaches have the advantage of statistical simplicity.  However, we have illustrated that standard software packages are available for more detailed and informative analyses.

Summarised-data-models of functional trait summaries are analogous to regression models based on block averages.  Such models are rarely used because ignoring within-block variation can lead to erroneous conclusions (e.g. \citenp{GelmanAndHill2007}, p. 311).  Hard work goes into collecting ecological data; ecological models should therefore be based on all of the available information.




%If we had analysed the summarised data only (Figure \ref{fig:cwmfits}), we would have concluded that there is a strong link between the Julian \texttt{day} gradient and body \texttt{size}.  However, by taking our more detailed full-data-modelling approach (Figure ??), we discovered that there is very little evidence for this interpretation.  In particular, the data are more consistent with the idea that one small-bodied taxon, colonial rotifers, increases in abundance throughout the season, and this is the primary driver of the decline of community-weighted mean body length.  Using full-data-models that account for these taxon effects, we found no evidence of an interaction between body \texttt{size} and Julian \texttt{day}.    Thus our approach provides a much clearer picture of what the data are saying (i.e. much less information loss).


%  Compare this situation with the usual case in observational statistics, in which there is no general diagnostic tool for detecting the influence of unmeasured variables---commonly leading to biased estimates of the effects of measured variables (e.g. ).  Not only have we demonstrated that taxon effects can provide an important diagnostic tool, but we have also illustrated how to use taxon effects in mixed-effects models to provide better estimates of the effects of measured traits of species' gradient responses.

%Extensions of the modelling approach (e.g. censoring; link functions; etc.).

%Multiple traits and gradients...

%Connections with genetics and random-effects models...

%Simply by looking at the residuals for six fixed-effects models, we have uncovered much information about the data.  


\section*{Acknowledgements}

We thank Laura Timms and Charles Nock for reading the manuscript.  SW benefited from valuable discussions with Ben Bolker.  This research was supported by NSERC grant no. 7738-07 to P. Legendre.

\bibliographystyle{ecology}
% ***   Set the bibliography file.   ***
% ("thesis.bib" by default; change if needed)
\bibliography{/Users/stevenwalker/Documents/Bibliography/Bibliography}

\makeatletter \renewcommand{\@dotsep}{10000} \makeatother   %% eliminates dots in list of figures
\clearpage    %% makes sure that the last page of the references has a page number (not sure why this works)
\pagenumbering{gobble}    %% eliminates page numbers in list of figures and figures

\listoffigures

\end{document}