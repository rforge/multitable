 \documentclass[12pt]{ecology}

\usepackage{tikz}
\usepackage{textpos}
\usepackage{verbatim}

\input{mythesisdefs}
\renewcommand{\listfigurename}{Figure legends}  % changes the name of the list of figures
\linenumbers 

%\title{What do community-weighted traits tell us about trait-by-environment interactions on species abundances?}
%\title{A linear theory on the effects of interactions between site and species characteristics on community composition}
%\title{What are we missing with community-weighted traits?}
%\title{Understanding the variation lost by community-weighted traits}
%\title{What information is lost by community-weighted mean traits and other trait-based statistical procedures?  The importance of residual analysis}
\title{Information loss via community-weighted averaging and other trait-based analyses:  how signal + noise modeling can help}
%\title{Taxon effects and other phenomena left undetected by trait-based community ecology:  a mixed-effects approach}
%\title{A mixed modelling approach to combining both taxonomic and trait-based information }
\runninghead{T-by-E interactions}
\author{Steven C. Walker}
\coauthor{Guillaume Gu\'{e}nard, Pierre Legendre, Beatrix Beisner}
\runningauthor{Walker et al.}
\address{Universit\'{e} de Montr\'{e}al}
\email{steve.walker@utoronto.ca}

\begin{document}
\maketitle
% left justification with indented paragraphs
\raggedright
\parindent=1.5em

\abstract{

}

\section{Introduction}

Perhaps one of community ecology's few laws is that species respond differently to spatial, temporal, and environmental gradients \citep{Gleason1917,Whittaker1967}.  These differences are not entirely due to neutral historical contingencies, but are maintained by corresponding differences in the traits of species (e.g. \citenp{Tilman1982}; \citenp{Reynolds1984}; \citenp{Tilman1988}; \citenp{LegendreEtAl1997}; \citenp{Tilman2004}; \citenp{AckerlyAndCornwell2007}), which implies that gradients can be characterised and understood in terms of the traits of the species that vary along them.  The methodology of community-weighted mean traits is often used for such characterisations (e.g. \citenp{EhleringerAndCooper1988}; \citenp{DiazAndCabido1997}; \citenp{terSteegeEtAl2006}; \citenp{DiazEtAl2007}; \citenp{FortunelEtAl2009}; \citenp{LavorelEtAl2011}; \citenp{SpasojevicAndSuding2011}).  In this approach, traits are averaged over the species found in a series of replicate sites.  This averaging is done in a weighted manner where the weights are measures of the relative abundance or occurrence of the species at each site.  Community-weighted means can be used to address questions such as:  `are cooler sites associated with larger-bodied species on average?' or `are more urbanized sites associated with a higher proportion of invasive species?'.  By relating species characteristics to site characteristics in this way, ecologists are building the empirical foundation necessary for unifying community ecology with mechanistic approaches in physiological ecology and biogeochemistry (e.g. \citenp{McGillEtAl2006}).

Still, potentially important information is lost when community-weighted means are used, because averaging removes variation.  The most common way to manage this problem is to use functional and taxonomic diversity indices (e.g. \citenp{PetcheyAndGaston2002}; \citenp{WalkerEtAl2008}) to quantify variation around community-weighted means (e.g. \citenp{DiazEtAl2007}; \citenp{SpasojevicAndSuding2011})---more indices capture more information.  However, this approach raises challenging questions about which indices to use (e.g. \citenp{PodaniAndSchmera2006}; \citenp{PetcheyAndGaston2007}; \citenp{PoosEtAl2009}).  Another approach is to use randomisation tests to directly assess hypotheses about the relationships between species and site characteristics and site-by-species abundance (or occurrence) matrices (e.g. \citenp{DoledecEtAl1996}; \citenp{LegendreEtAl1997}; \citenp{AckerlyAndCornwell2007}; \citenp{DrayAndLegendre2008}; \citenp{CormontEtAl2011}).  However, because this approach specifies only the null and not the alternative model, it risks having low power for detecting the most interesting departures from the null---a form of information loss.

Here we argue that information loss in trait-based community studies can be assessed by fitting statistical models to sites-by-species abundance (or occurrence) matrices, using site and species characteristics as predictors.  This approach provides a decomposition of the data into signal and noise.  Therefore, one can check the residuals for systematic trends, the existence of which indicates missing information in the signal portion of the model---suggesting model improvements.  The fitted abundances (or occurrences) of such models can also be used to make predictions about community-weighted means and other functional diversity summaries, but with the added benefit of providing diagnostic tools for assessing information lost by summarisation.  Models that are capable of providing such tools have only recently begun to be considered (e.g. \citenp{WebbEtAl2010}; \citenp{IvesAndHelmus2011}).  Here we describe (1) simple graphical models that identify the types of information that can be lost via community-weighted averaging and (2) how residual analysis can diagnose information lost by trait-based summaries, using data on a zooplankton community in Lac Croche, Qu\'{e}bec, Canada.



%However, an alternative option is emerging that promises to greatly enhance our understanding of communities (\citenp{WebbEtAl2010}; \citenp{IvesAndHelmus2011}).  In this approach, both species and site characteristics are used to explain and predict variation in performance (e.g. abundance; occurrence; biomass) across species and sites.  Such models have the potential to use all of the information in the data, and therefore addresses our main criticism with community-weighted mean traits and other functional diversity indices.  More importantly, this approach is more likely to let the data speak than methods based on suits of functional diversity indices and other more sophisticated multivariate techniques.  For example, one might find a pattern in the residuals that leads to an adjustment of model assumptions, thereby leading to a better understanding of the data.  In contrast, when a particular suit of functional diversity indices is used to summarise a data set, no such residual analysis is available to check how well the information in the data is being captured by this particular suit of indices.  Therefore, by modelling the non-summarised data directly one can clarify what information is being lost via functional diversity summaries, leading to a more empirically correct understanding of the relationships between species and site characteristics and variation in performance across species and sites.



%A more direct approach is to model the relationships between matrices of site and species characteristics and site-by-species abundance (or occurrence) matrices.  Because community-weighted means and functional diversity indices are calculated from such matrices, such a direct approach will provide insight into the information missed by summary indices.  More importantly, fundamental ecological theory is more concerned with abundance, traits, and gradients, than with summary indices of these variables---hence our approach provides a stronger connection with the theoretical context within which empirical questions are derived.  For example, a model of the interaction between stomatal conductance and relative humidity on abundance will likely have clearer theoretical underpinnings than a model of how a suit of functional diversity indices vary along a relative humidity gradient.

%Statistical modelling of community data can be challenging however because of violated assumptions required by standard software packages (e.g. normality, linearity, homogeneity).  This problem is worsening as traits, phylogenies, and other data on species characteristics are complicating community ecological data sets.  There are essentially two general approaches for dealing with these difficulties.  The first approach is to use randomisation tests to validly evaluate models that violate assumptions; this null model approach has a long history in ecology \citep{GotelliAndGraves1996} and is being continued within traits-based community ecology (e.g. \citenp{DoledecEtAl1996}; \citenp{LegendreEtAl1997}; \citenp{AckerlyAndCornwell2007}; \citenp{DrayAndLegendre2008}; \citenp{CormontEtAl2011}).  However, an alternative option is emerging that promises to greatly enhance our understanding of communities (\citenp{WebbEtAl2010}; \citenp{IvesAndHelmus2011}).  In this approach, both species and site characteristics are used to explain and predict variation in performance (e.g. abundance; occurrence; biomass) across species and sites.  Such models have the potential to use all of the information in the data, and therefore addresses our main criticism with community-weighted mean traits and other functional diversity indices.  More importantly, this approach is more likely to let the data speak than methods based on suits of functional diversity indices and other more sophisticated multivariate techniques.  For example, one might find a pattern in the residuals that leads to an adjustment of model assumptions, thereby leading to a better understanding of the data.  In contrast, when a particular suit of functional diversity indices is used to summarise a data set, no such residual analysis is available to check how well the information in the data is being captured by this particular suit of indices.  Therefore, by modelling the non-summarised data directly one can clarify what information is being lost via functional diversity summaries, leading to a more empirically correct understanding of the relationships between species and site characteristics and variation in performance across species and sites.


%Therefore, by modelling how all of these indices vary along gradients, one obtains a more complete understanding of the data.

%The community-weighted mean approach is therefore able to establish when a given trait is implicated in the maintenance of interspecific variation in species' gradient responses.

%This inter-specific diversity of gradient responses implies that the performance (e.g. abundance; occurrence; biomass) of a particular species in a particular portion of space and time depends on the characteristics of both the species (i.e. traits; phylogenetic autocorrelation) and the portion of space-time (e.g. resources; environmental conditions; landscape features) \citep{WebbEtAl2010}.

%The reasons for the importance of traits in determining variation in community composition are theoretically well-studied.  In competitive communities for example, two species cannot coexist if their traits are sufficiently similar---referred to as the principle of limiting similarity---and this.

%Much recent empirical work exploring the relationships between species' traits and environmental gradients has used the methodology of community-weighted mean traits (refs ??).

%Still, information about how communities respond to gradients is lost when this community-weighted mean approach is used.  Whenever an average is taken information is lost about the entities averaged over, which in this case are species.  Although the community-weighted mean approach clarifies that traits are implicated in interspecific variation in species' gradient responses but  



%  Another approach is to use various ordination and multivariate permutation procedures that have been developed specifically for relating traits and environmental variables (e.g. \citenp{DoledecEtAl1996}; \citenp{LegendreEtAl1997}; \citenp{AckerlyAndCornwell2007}; \citenp{DrayAndLegendre2008}; \citenp{CormontEtAl2011}).  

%All of these approaches can be referred to as procedural (\emph{sensu} \citenp{Bolker2009}), in that there is a well-defined procedure to be followed that will work for any data set of a particular form.

%Although these approaches have been useful, they all suffer from an important weakness:  they make use of data summaries that are recommended by statistical ecologists, rather than suggested by the data themselves.  



%Although such detailed statistical modelling has many potential benefits, there is little guidance on how to conduct such an approach.  


%In general, we are shift from \citep{Bolker2009}



%We explicitly identify three main types of patterns that can go undetected when using community-weighted mean traits in gradient analysis:  (1) effects of species' identities on abundance or occurrence patterns that are not explained by measured traits (taxon-effects); (2) systematic variation in abundance and taxonomic richness along gradients (main gradient-effects); and (3) the shapes of species' responses along gradients (effects on taxonomic beta diversity).  It is relatively simple to understand why community-weighted means obscure taxon-effects; two species may respond very differently to an environmental gradient even though they share very similar traits.  Such a trend would go undetected by a community-weighted mean approach because all species-specific information is averaged out.  Such taxon-effects can be related to either key traits that are missing from the data set (the niche case) or to historical contingencies (the neutral case).  Therefore, considering taxon-effects can be the first step to hypotheses about important factors (e.g. traits or historical factors such as post-glacial dispersal routes) missing from a data set.  An example of a main gradient-effect would be that species richness is lower in higher latitudes relative to the tropics (e.g. refs??).  Community-weighted mean traits using occurrences as weights would fail to detect such a pattern.  Similarly, as will be demonstrated below, metacommunities with very different levels of taxonomic beta diversity can have virtually identical relationships between a community-weighted mean and a gradient.


%A key element of statistical fluency in general is an ability to appreciate the information that a given data summary may conceal.  For example, it is now widely appreciated by statistically fluent scientists that correlation coefficients provide no information about the linearity of bivariate relationships, a fact influentially used by \citet{Anscombe1973} to advocate for the routine use scatterplots in data analysis.  Similarly, w

%    This trend is true even though species with certain traits are more abundant in higher latitudes



%   We argue that  It might be argued that community-weighted means were not designed to address taxonomic diversity-, taxon-, or non-linear-effects, and therefore that one need only be aware of these effects when using community-weighted means.  However, 

\section{Illustrative graphical models}

Let $y_{ij}$ be the abundance or occurrence of species $j (= 1, ..., m)$ at site $i (= 1, ..., n)$ and $z_j$ be the value of a particular trait for species $j$.  The community-weighted mean of this trait is,
\begin{equation} 
\bar{z}_i = \sum_{j=1}^m \frac{y_{ij} z_j}{y_{ij}}
\label{eq:cwmdef}
\end{equation}
This equation allows us to summarise the $nm$ species abundances and $m$ trait values into $n$ community-weighted means.  Therefore, the original data are composed of $\frac{m(n + 1)}{n} \approx m$ ($\equiv$ species richness) times as many numbers as the summarised data, indicating the potential for information loss via summarisation.  The purpose of this paper is to explore the consequences of this information loss when studying communities along gradients.
%, and to propose an alternative to community-weighted means.

Our key theoretical result is that a single pattern of community-weighted means can arise from otherwise distinguishable metacommunities.  Consider the simulated positive relationship between a community-weighted mean trait and an environmental gradient in Figure \ref{fig:graphicalmodels}A.  This figure consists of seven different curves from different hypothetical metacommunities of eleven species each (Figures \ref{fig:graphicalmodels}B-H), but the curves are so similar that they are indistinguishable.  The first metacommunity (Figure \ref{fig:graphicalmodels}B) serves as a control because it is one of the simplest scenarios consistent with the increasing curve in Figure \ref{fig:graphicalmodels}A.  In this metacommunity, species with large trait values respond positively to the gradient whereas those with small values respond negatively---a trait-gradient interaction.  Still, many other scenarios are also consistent with Figure \ref{fig:graphicalmodels}A.

\begin{figure}

\includegraphics[width=5.5in]{multispeciesCWMcartoons.pdf}

\caption{The relationships between a community-weighted mean trait and an environmental gradient (A) for seven different metacommunities (B-H).  The lines in (A) are indistinguishable, indicating that information on the differences of the metacommunities is lost by community-weighted averaging.  The lines in B-H correspond to individual species, with trait value indicated by numbers.}
\label{fig:graphicalmodels}

\end{figure}

In the control metacommunity (Figure \ref{fig:graphicalmodels}B), species' trait values determine their response to the gradient; we refer to cases where this is not true as taxon effects, which indicate that measured traits are unable to explain differences in how taxa respond to measured gradients.  For example, the metacommunity in Figure \ref{fig:graphicalmodels}C contains groups of species with identical trait values, which nevertheless have different relationships with the gradient.  A more subtle taxon effect is depicted in Figure \ref{fig:graphicalmodels}D.  Here, each species has its own unique trait value, but some species behave very differently from other species with similar trait values.  For example, the species with value 0.4 is negatively related to the gradient whereas the species with value 0.2 is positively related.  Taxon effects are not detectable with community-weighted means.

In the control metacommunity (Figure \ref{fig:graphicalmodels}B), there is no overall relationship between abundance and the gradient (as one species declines another increases to compensate); we refer to cases where this is not true as main gradient effects.  For example, the metacommunity in Figures \ref{fig:graphicalmodels}E and F are characterised by positive and negative main gradient effects.  Notice further that although the community-weighted mean increases along the gradient, main gradient effects can result in species with negative trait values to actually increase (e.g. Figure \ref{fig:graphicalmodels}E).  Main gradient effects are not detectable with community-weighted means.

In the control metacommunity (Figure \ref{fig:graphicalmodels}B), beta diversity is relatively low (species with positive trait values are abundant at one side of the gradient while those with negative values are abundant at the other); we refer to cases where this is not true as effects on beta diversity.  For example, the metacommunity in Figure \ref{fig:graphicalmodels}G has much higher beta diversity because species have more restricted environmental tolerances.  Figure \ref{fig:graphicalmodels}H gives a more complex example, where species with more extreme trait values have higher abundances.  Effects on beta diversity are not detectable with community-weighted means.

%Because species' abundances have trait-dependent relationships with environmental gradients, we can expect community-weighted mean traits to also relate to such gradients.  If one knew how each species in the metacommunity varied along gradients, one could deduce how a community-weighted mean would vary along gradients by plugging values into Eq. \ref{eq:cwmdef}.  To some extent one can go the other way as well, from knowledge of community weighted means to knowledge of species' abundances.  In particular, a relationship between a community-weighted mean and a gradient implies variation in abundance that is at least partially explainable by an interaction between the trait and gradient.  However---and this is the main point of this paper---the form of the interaction is unclear; one cannot deduce individual species' relationships between abundances and environmental gradients from a knowledge of how community-weighted mean traits relate to these gradients.

%Consider the simplest possible case: a single environmental gradient and a trait that takes one of two possible values, $-1$ and $+1$, which could reflect any binary trait (e.g. deciduous or coniferous tree species).  Suppose that there is a negative linear relationship between the gradient and the community-weighted trait (Figure \ref{fig:graphicalmodels}A).  If the weighting is done using species abundances, such a result provides some information about the linear trends in the relative abundances of each species in response to the gradient; in particular, it tells us that species with trait value $+1$ tend to respond less positively in relative abundance to the gradient than species with trait value $-1$.  The simplest possible scenario that is consistent with this negative response is a two-species metacommunity in which a species with trait value $-1$ increases in abundance along the gradient while a species with trait value $+1$ decreases along it (Figure \ref{fig:graphicalmodels}B).  But, as we will see next, a declining CWM trait does not necessarily imply that species with large trait values are declining along the gradient while those with small trait values are increasing, as many researchers might intuit.

%Several different scenarios (Figure \ref{fig:graphicalmodels}C-H) are consistent with the negative response of the community-weighted trait in Figure \ref{fig:graphicalmodels}A.  For example, it is possible that one of the two species in the metacommunity are completely unaffected by the gradient (Figure \ref{fig:graphicalmodels}C,D).  These two scenarios indicate that a trend in CWMs could be driven by a single species, raising doubts about viewing CWMs as indicators of whole community structure rather than indicators of species with particular trait values.  Another pattern that is consistent with a linear decline in community-weighted means is one species with a hump-shaped relationship and the other with a sigmoidal relationship (Figures \ref{fig:graphicalmodels}E,F).  This possibility demonstrates how linear trends in community-weighted means can hide interesting non-linearities.  It is also possible that species with the same traits can have different responses to the gradient (Figure \ref{fig:graphicalmodels}G).  A more extreme version of such a case is also possible in which a $-1$ species has a negative relationship with the gradient and a $+1$ species has a positive relationship (Figure \ref{fig:graphicalmodels}H), despite the overall negative relationship in the community-weighted mean (Figure \ref{fig:graphicalmodels}A).

%These examples demonstrate that community-weighted mean traits can hide information.  The simplicity of these examples suggests that this issue could be exacerbated with complex data from natural species-rich metacommunities.  Next we describe one such real data set.

%What distinguishes these three scenarios are different main effects of the gradient on species' abundances in general, on which CWMs contain no information.  In particular, panels B, C, and D illustrate positive, negative, and zero main effects, despite the fact that they are all consistent with the same CWM pattern along the gradient (Figure \ref{fig:graphicalmodels}A).  It turns out that this issue can be addressed by a relatively simple modification of the CWM methodology, called bilinear modelling, which we describe in the next section.

%The second type of pattern that CWMs are silent on are species effects.  Specifically, it is possible that different species with the same trait value could have different relationships with the gradient.  For example, some $-1$ species could be more positively related to the gradient than others and some $+1$ species could be more negatively related to the gradient than others (Figure \ref{fig:graphicalmodels}E).  However, this pattern could be made even more extreme such that some $+1$ species increase along the gradient and some $-1$ species decrease along it (Figure \ref{fig:graphicalmodels}F), even though the CWM is decreasing (Figure \ref{fig:graphicalmodels}A).  This second type of pattern is interesting because it indicates that the measured trait does not adequately explain interspecific variation in environmental responses.  Adequately modelling such patterns will require more sophisticated models with random species effects (e.g. Ives and Helmus 2011).  However, we show how our bilinear modelling framework can be used to diagnose such issues and provide insight into the nature of the random species effects.  We also give an example from a study on the effects of the thermocline depth on zooplankton community structure, which gives a concrete example of the benefits of going beyond community-weighted traits.

\section{Methods}

\subsection{Data}

The information lost by community-weighted analyses is not just a theoretical issue, but can also have consequences for interpreting real data.  We now illustrate these consequences by analysing the dynamics of the zooplankton community in a basin of Lac Croche, Qu\'{e}bec, Canada.  The densities of twelve zooplankton taxa were sampled ten times throughout the summer of 2008 between ?? and ??.  For simplicity of exposition, we focus on the relationship between density, a single gradient, and a single trait.  However, our ideas are applicable to any measure of abundance and occurrence and arbitrarily many gradients and traits.  Lakes undergo many environmental changes throughout the summer such as a deepening thermocline, increases in water temperature, and so we use Julian day as our gradient.  Body size is likely to influence how different zooplankton groups respond to seasonal environmental changes, and so we use average body length in mm as our trait.  ***NEEDS TO BE MUCH BETTER HERE***

When referring to this data set specifically, we denote Julian day, body length, and abundance as \texttt{day}, \texttt{size}, and \texttt{abnd} respectively.  When referring to abundance, gradients, and traits in general, we use $y_{ij}$, $x_i$, and $z_j$.

%In particular, we show that the response of a community-weighted trait along an environmental gradient can be driven by a single group, indicating that inferred patterns may not have very much relevance at the community level.  We then demonstrate how more detailed modelling of the joint effects of a gradient and a functional trait on species' abundances provides a much clearer picture of community structure.

\subsection{Statistical models}

We consider two types of models : summarised data and full data models.  Summarised-data models use a community-weighted mean trait as a response variable and a gradient as an explanatory variable.  Full-data models use abundance (or occurrence) as a response variable and a gradient and trait as explanatory variables.  Although full-data models are not based on data summaries, they can be used to make inferences about summaries.  For example, let $\hat{y}_{ij}$ be the full-data-model prediction for the density, $y_{ij}$, of species $j$ at site $i$.  


  Although full-data models can be used to make inferences about both summarised- and full-data, summarised-data models can only be used to make inferences about summarised-data; put differently, full-data models use all available information whereas summarised-data models use only the summarised information.  

\begin{equation}
\mathrm{E}(\bar{z}_i) = \mathrm{E}\left( \sum_{j=1}^m \frac{y_{ij} z_j}{y_{ij}} \right) \approx \sum_{j=1}^m \frac{\hat{y}_{ij} z_j}{\hat{y}_{ij}}
\end{equation}

In trait-based community ecology, it is not sufficient to describe how different taxa respond to gradients.  Instead, we seek to understand what traits are responsible for this interspecific variation in gradient responses.  Therefore, our main causal question of interest is:  what are the effects of interactions between gradients and traits on abundance (or occurrence)?  We begin to explore this question by considering models of the form,
\begin{equation}
\hat{y}_{ij} = c + 
	\sum_k b_k \mathrm{f}_k (x_i, z_j)
\end{equation}
where the $\hat{y}_{ij}$ are fitted values for the $y_{ij}$, the $\mathrm{f}_k$ are known functions of the site and taxon characteristics, the $b_k$ are coefficients, and the $y_{ij}$ are distributed normally with means $\hat{y}_{ij}$,
\begin{equation}
y_{ij} \sim \mathcal{N}(\hat{y}_{ij},\sigma^2)
\end{equation}
This model is a generalisation of the trait-based model considered by \citet{CormontEtAl2011} and is known in the statistics literature as a bilinear model \citep{Gabriel1998}.  The \citet{CormontEtAl2011} model is the special case for which $\mathrm{f}_1(x_i, z_j) = x_i$, $\mathrm{f}_2(x_i, z_j) = z_j$, and $\mathrm{f}_3(x_i, z_j) = x_i z_j$.  The third function accounts for standard multiplicative interactions between the site and taxon characteristics.  Note also however that this model can characterise main gradient effects (Fig. ??) by the first function, as well as main trait effects by the second; thus, we view the approach of \citet{CormontEtAl2011} as an advance over standard community-weighted mean trait and functional diversity analyses.  By extending the model to include two other functions, $\mathrm{f}_4(x_i, z_j) = x_i^2$ and $\mathrm{f}_5(x_i, z_j) = x_i^2 z_j$, non-linearities in gradient responses can be modelled and therefore effects on beta diversity (Fig. ??) assessed.

A major shortcoming of this bilinear model is that it does not account for taxon effects (Fig. ??), which will be present whenever there are unmeasured (or unconsidered) traits that explain substantial portions of variation in species' gradient responses (Section ??).  The simplest taxon effects are differences in residual variance among taxa.  We account for these effects by giving each taxon its own residual variance parameter,
\begin{equation}
y_{ij} \sim \mathcal{N}(\hat{y}_{ij},\sigma_j^2)
\end{equation}
A more challenging type of taxon effect manifests itself as a taxon-specific bias in the residuals.  The abundances of taxa with such a bias are consistently under- or over-estimated.  Another type of taxon effect manifests itself as a taxon-specific trend in the residuals along the gradient.  However, because these taxon effects result from unmeasured (or unconsidered) traits, they offer little insight for trait-based community ecology.  Furthermore, incorporating fixed taxon effects into the model requires many degrees of freedom (proportional to species richness, $m$).  Still, taxon effects should be accounted for in order to provide reliable estimates of the effects of the measured traits.  

Mixed effects models (refs?) often provide useful tools to account for nuisance sources of variability (taxon effects in this case), which are economical in degrees of freedom.  Here we modify Eq. ?? to be a mixed model by adding random effects of the gradient, with taxon as the grouping factor,
\begin{equation}
\hat{y}_{ij} = c + 
	\sum_k b_k \mathrm{f}_k (x_i, z_j) + 
	\sum_l \beta_{lj} \mathrm{g}_l (x_i)
\end{equation}
where the $\mathrm{g}_l$ are known functions of the site characteristics and the $\beta_l$ are coefficients for random effects assumed to be normally distributed,
\begin{equation}
\beta_{lj} \sim \mathcal{N}(0,\sigma_l^2)
\end{equation}
This model is highly flexible and can account for taxon effects, main gradient effects, and effects on beta diversity.

\subsection{Model identification and checking}

We identified a specific model for the Lac Croche data by examining the residuals of tentative models, in order to identify features that either should or should not be included in the final model (e.g. \citenp{GelmanAndHill2007}; \citenp{ZuurEtAl2009}).  For each inadequate model, we expect to find evidence of inadequacy in the residuals.  Our graphical models (Section ??) prepare us for four main types of effects:  taxon effects, main gradient effects, main trait effects, and /or effects on beta diversity.  For fixed effects models, we use simple observed versus expected residuals, $y_{ij} - \hat{y}_{ij}$.    For mixed-effects models we use normalised residuals \citep{PinheiroAndBates2000}, which have the benefit of being approximately normally distributed with mean zero and standard deviation one for each taxon if model assumptions are met.  We used the \texttt{R} \texttt{lm} and \texttt{lme} functions for fitting fixed- and mixed-effects models \citep{R2009}.

\section{Results}

Community-weighted body length was significantly (ordinary linear regression, $F = 65.1$, $p < 0.001$) and negatively (linear model in Figure \ref{fig:cwmfits}) related to day of year, implying that communities became more dominated by smaller-bodied species throughout the season.  The curved dotted line in Figure \ref{fig:cwmfits} gives the predictions from a mixed-effects model of a form given by Eq. ??.  This mixed-effects model also fits the data well but predicts a deceleration of the rate of decline in community-weighted body length.  This deceleration keeps the predicted values greater than the minimum possible community-weighted mean (i.e. the body length of the smallest species, given by the thick horizontal line in Figure \ref{fig:cwmfits}); in contrast, the linear model predicted unrealistically low community-weighted means late in the season.  More importantly, this mixed-effects model describes the data in more depth, as it is not only able to describe the community-weighted mean pattern but also the full non-summarised data (Figure \ref{fig:randomeffectsfit}).  The remaining results explain how this model was selected.

%Furthermore, the process of deciding on the specific form for this mixed-effects model generated much more insight about the data than the ordinary linear regression model, as we now describe.

\begin{figure}
\includegraphics{cwmfits.pdf}
\caption{}
\label{fig:cwmfits}
\end{figure}

\begin{figure}
\includegraphics{randomeffectsfit.pdf}
\caption{}
\label{fig:randomeffectsfit}
\end{figure}

Our model building began by examining departures of the data from fits to very simple fixed-effects models, of the form of Eq.??.  Residual plots revealed problems with six such models (Figure \ref{fig:fixedeffectsresiduals}).  Julian \texttt{day} alone explains very little variation in \texttt{abundance} (Figure \ref{fig:fixedeffectsresiduals}, \texttt{abnd} $\sim$ \texttt{day}).  In contrast with Julian \texttt{day}, body \texttt{size} alone explains much more variation in \texttt{abundance} but there is a strong quadratic trend to the residuals (Figure \ref{fig:fixedeffectsresiduals}, \texttt{abnd} $\sim$ \texttt{size}), suggesting that moderately sized species are least abundant (Figure \ref{fig:fixedeffectsresiduals}, \texttt{abnd} $\sim$ \texttt{size} + \texttt{size} $\hat{}$ 2).  Although Julian \texttt{day} explained very little variation on its own, perhaps its interaction with \texttt{size} explains more?  However, the interaction between \texttt{day} and \texttt{size} was only able to explain a little bit more of the variation than the quadratic \texttt{size} model (Figure \ref{fig:fixedeffectsresiduals}, compare \texttt{abnd} $\sim$ \texttt{size} + \texttt{size} $\hat{}$ 2) with \texttt{abnd} $\sim$ \texttt{day} + (\texttt{size} + \texttt{size} $\hat{}$ 2)).

\begin{figure}
\includegraphics{fixedeffectsresiduals.pdf}
\caption{}
\label{fig:fixedeffectsresiduals}
\end{figure}

The first four fixed-effects models all show signs of taxon effects.  The most evident such pattern is the fact that colonial rotifers tend to have positive residuals (upward triangles in Figure ??).  Such taxon effects suggest that a model with \texttt{taxon} as a factor will explain variation.  Indeed, a fixed effects model with only \texttt{taxon} as a factor explains much more variation than the other four models (Figure ?, \texttt{abnd} $\sim$ \texttt{taxon}).  However, there are still taxon-effects present in the residuals of this model.  In particular, all taxa do not appear to all have the same residual variance (e.g. the residuals for colonial rotifers are more variable than for the other taxa).  Perhaps, some of this variance could be explained by taxon-specific relationships with Julian \texttt{day}?  Indeed this is the case, but there still appear to be taxon-specific residual variances (Figure ??).

Taken together, these six fixed-effects models suggest that a better model for these data would include (1) a quadratic effect of body \texttt{size}; (2) taxon-specific residuals; and (3) a \texttt{taxon}-specific effect of Jullian \texttt{day} (and possibly its square).  We fit a mixed-effects model with these properties to the data (Appendix for details).  The normalised residuals for this model show no obvious violations of its assumptions (Figure \ref{fig:randomeffectsresiduals}), conferring confidence in inferences draw from it.  For example, we infer that there is little evidence of an interaction between \texttt{day} and \texttt{size} \emph{per se}, with more support for interactions between \texttt{day} and other unmeasured (or unconsidered) traits as evidenced by the need to account for taxon-specific \texttt{day} effects.  Furthermore, we failed to reject our selected model against an alternative with a fixed effect of the interaction between \texttt{day} and \texttt{size} (LR $= 2.18$, $p = 0.14$).

%%%%%%%%%%%%%
% appendix material???
%%%%%%%%%%%%%
\begin{figure}
\includegraphics{randomeffectsresiduals.pdf}
\caption{}
\label{fig:randomeffectsresiduals}
\end{figure}

\section{discussion}

If we stopped at the picture of community-weighted mean body length against Julian day, we would have made a story about the relationship between the gradient and body length \emph{per se}.  But, by taking our more detailed approach, we see that there is very little evidence for such a story.  In fact, the data are more consistent with the idea that one abundant taxon, colonial rotifers, is in decline throughout the season, and this is the primary driver of the pattern.  Furthermore, the variance component due to taxon effects is very large (??).  Finally, after taking account of the taxon effects, the model found no evidence of an interaction between body length and Julian day, but rather that taxa with more extreme body lengths tend to be more abundant.  Thus our approach provides a much clearer picture of what the data are saying (i.e. much less information loss).

Taxon effects may at first seem to be a problem in trait-based community ecology, but we see them as a valuable asset.  The presence of taxon effects provides a useful diagnostic for detecting whether unmeasured (or unconsidered) traits are important drivers of variation in species' responses to environmental, spatial, and temporal gradients.  Compare this situation with the usual case in observational statistics, in which there is no general diagnostic tool for detecting the influence of unmeasured variables---commonly leading to biased estimates of the effects of measured variables (e.g. ).  Not only have we demonstrated that taxon effects can provide an important diagnostic tool, but we have also illustrated how to use taxon effects in mixed-effects models to provide better estimates of the effects of measured traits of species' gradient responses.

Extensions of the modelling approach (e.g. censoring; link functions; etc.).

%Simply by looking at the residuals for six fixed-effects models, we have uncovered much information about the data.  

Polar bears!

\bibliographystyle{ecology}
% ***   Set the bibliography file.   ***
% ("thesis.bib" by default; change if needed)
\bibliography{/Users/stevenwalker/Documents/Bibliography/Bibliography}

\end{document}